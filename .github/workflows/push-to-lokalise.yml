# .github/workflows/push-to-lokalise.yml
#
# Automático: sube strings a Lokalise cada vez que
# cambia el .xcstrings en main
#
name: Push strings to Lokalise

on:
  push:
    branches:
      - main
    paths:
      - '**/Localizable.xcstrings'

jobs:
  push:
    # Evita loop infinito: no correr si el commit viene del pull action
    if: "!contains(github.event.head_commit.message, 'Update translations from Lokalise')"
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Install Lokalise CLI
        run: |
          curl -sfL https://raw.githubusercontent.com/lokalise/lokalise-cli-2-go/master/install.sh | sh
          sudo mv ./bin/lokalise2 /usr/local/bin/lokalise2

      - name: Upload xcstrings to Lokalise
        run: |
          lokalise2 \
            --token ${{ secrets.LOKALISE_API_TOKEN }} \
            --project-id ${{ secrets.LOKALISE_PROJECT_ID }} \
            file upload \
            --file "Buky/Resources/Localizable.xcstrings" \
            --lang-iso en \
            --replace-modified \
            --cleanup-mode \
            --detect-icu-plurals \
            --use-automations=true \
            --poll \
            --poll-timeout 600s

      - name: Verify upload
        run: echo "✅ xcstrings uploaded to Lokalise"
